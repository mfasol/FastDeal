View for inventory reconciliation 3
CREATE FORCE VIEW PUBLIC.V_INVENTORY_EVALUATOR(PRODUCT, TOTAL_VALUE, QUANTITY) AS
  (SELECT
     PRODUCT,
     ROUND(SUM(CASE WHEN ((TRANSACTION_STATUS IS NULL)
                          OR ((TRANSACTION_DATE < '2015-11-01')
                              AND (TRANSACTION_STATUS <> 'REFUND')))
       THEN ITEM_COS
               ELSE 0 END), 2) AS TOTAL_VALUE,
     SUM(CASE WHEN ((TRANSACTION_STATUS IS NULL)
                    OR ((TRANSACTION_DATE < '2015-11-01')
                        AND (TRANSACTION_STATUS <> 'REFUND')))
       THEN 1
         ELSE 0 END)           AS QUANTITY
   FROM (
          SELECT
            CONSOLIDATED_INVENTORY.PRODUCT_KEY              AS PRODUCT,
            CONSOLIDATED_INVENTORY.CONCATENATED_PRIMARY_KEY AS KEY,
            SALES_LEDGER.TRANSACTION_DATE,
            SALES_LEDGER.TRANSACTION_STATUS,
            CONSOLIDATED_INVENTORY.ITEM_COS
          FROM PUBLIC.CONSOLIDATED_INVENTORY
            LEFT OUTER JOIN (
              PUBLIC.SALES_LEDGER
              ) ON CONSOLIDATED_INVENTORY.CONCATENATED_PRIMARY_KEY = SALES_LEDGER.ITEM_ID
        ) _0
   GROUP BY PRODUCT)
  UNION ALL
  (SELECT
     'TOTAL',
     ROUND(SUM(CASE WHEN ((TRANSACTION_STATUS IS NULL)
                          OR ((TRANSACTION_DATE < '2015-11-01')
                              AND (TRANSACTION_STATUS <> 'REFUND')))
       THEN ITEM_COS
               ELSE 0 END), 2) AS TOTAL_VALUE,
     SUM(CASE WHEN ((TRANSACTION_STATUS IS NULL)
                    OR ((TRANSACTION_DATE < '2015-11-01')
                        AND (TRANSACTION_STATUS <> 'REFUND')))
       THEN 1
         ELSE 0 END)           AS QUANTITY
   FROM (
          SELECT
            CONSOLIDATED_INVENTORY.PRODUCT_KEY              AS PRODUCT,
            CONSOLIDATED_INVENTORY.CONCATENATED_PRIMARY_KEY AS KEY,
            SALES_LEDGER.TRANSACTION_DATE,
            SALES_LEDGER.TRANSACTION_STATUS,
            CONSOLIDATED_INVENTORY.ITEM_COS
          FROM PUBLIC.CONSOLIDATED_INVENTORY
            LEFT OUTER JOIN (
              PUBLIC.SALES_LEDGER
              ) ON CONSOLIDATED_INVENTORY.CONCATENATED_PRIMARY_KEY = SALES_LEDGER.ITEM_ID
        ) _0)
