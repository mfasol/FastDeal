CREATE OR REPLACE FORCE VIEW PUBLIC.V_PURCHASE_LEDGER_PRODUCT_STATUS_PIVOT(PRODUCT_KEY, TOTAL, ACCRUAL) AS
SELECT
    PRODUCT_KEY,
    SUM(QUANTITY),
    SUM(CASE WHEN (TRANSACTION_TYPE = 'ACCRUAL') THEN QUANTITY ELSE 0 END) AS ACCRUAL
FROM PUBLIC.PURCHASE_LEDGER
    /* PUBLIC.PURCHASE_LEDGER.tableScan */
WHERE (INVENTORY_RELEVANT = TRUE)
    AND (TRANSACTION_TYPE <> 'REVERSAL')
GROUP BY PRODUCT_KEY
