CREATE OR REPLACE FORCE VIEW PUBLIC.V_INVENTORY_PRODUCT_STATUS_PIVOT(PRODUCT_KEY, SOLD, SELLABLE, CHECK) AS
(SELECT
    PRODUCT_KEY,
    SOLD,
    SELLABLE,
    (SELLABLE + SOLD) AS CHECK
FROM (
    SELECT
        PRODUCT_KEY,
        SUM(CASE WHEN (INVENTORY_ITEM_STATUS = 'SOLD') THEN 1 ELSE 0 END) AS SOLD,
        SUM(CASE WHEN (INVENTORY_ITEM_STATUS = 'AVAILABLE_FOR_SALE') THEN 1 ELSE 0 END) AS SELLABLE
    FROM PUBLIC.INVENTORY_ITEMS_GB_AMAZON
        /* PUBLIC.INVENTORY_ITEMS_UK_AMAZON___FK_INDEX_7 */
    GROUP BY PRODUCT_KEY
    /* group sorted */
) _0
    /* SELECT
        PRODUCT_KEY,
        SUM(CASE WHEN (INVENTORY_ITEM_STATUS = 'SOLD') THEN 1 ELSE 0 END) AS SOLD,
        SUM(CASE WHEN (INVENTORY_ITEM_STATUS = 'AVAILABLE_FOR_SALE') THEN 1 ELSE 0 END) AS SELLABLE
    FROM PUBLIC.INVENTORY_ITEMS_GB_AMAZON
        /++ PUBLIC.INVENTORY_ITEMS_UK_AMAZON___FK_INDEX_7 ++/
    GROUP BY PRODUCT_KEY
    /++ group sorted ++/
     */)
UNION ALL
(SELECT
    'TOTAL',
    SUM(CASE WHEN (INVENTORY_ITEM_STATUS = 'SOLD') THEN 1 ELSE 0 END),
    SUM(CASE WHEN (INVENTORY_ITEM_STATUS = 'AVAILABLE_FOR_SALE') THEN 1 ELSE 0 END),
    SUM(CASE WHEN (INVENTORY_ITEM_STATUS <> 'REVERSE') THEN 1 ELSE NULL END)
FROM PUBLIC.INVENTORY_ITEMS_GB_AMAZON
    /* PUBLIC.INVENTORY_ITEMS_GB_AMAZON.tableScan */)
